# ğŸ¾ FurryOS venv Guide

## Why Include a venv in the ISO?

**The Problem**: Different systems have different Python configurations. Some have PEP 668 "externally-managed" restrictions, different package versions, or missing dependencies.

**The Solution**: Bundle a portable, pre-configured Python environment WITH the ISO. Users get:

- âœ… Guaranteed working Python environment
- âœ… No system Python conflicts
- âœ… Offline build capability (no internet needed)
- âœ… Consistent experience across all systems

---

## ğŸš€ Quick Start (No Reboot Needed!)

### Option 1: Fresh Build Environment in /TOP

```bash
cd /TOP

# Create the venv (one-time setup)
./setup_venv.sh

# Activate it
source activate_furryos.sh

# Now build FurryOS
sudo -E python3 launcher.py
sudo -E python3 deploy_iso.py

# Deactivate when done
deactivate
```

**Note**: You DON'T need to reboot! The venv isolates everything.

### Option 2: Let Scripts Auto-Detect

The scripts automatically detect and use `furryos_venv/` if it exists:

```bash
cd /TOP

# Create venv first
./setup_venv.sh

# Scripts automatically use it (no activation needed!)
sudo ./launcher.py    # Detects venv automatically
sudo ./deploy_iso.py  # Detects venv automatically
```

---

## ğŸ“¦ Bundle venv WITH the ISO

### Step 1: Create venv

```bash
cd /TOP
./setup_venv.sh
```

This creates `furryos_venv/` with all dependencies.

### Step 2: Archive it

```bash
tar -czf furryos_venv.tar.gz furryos_venv/
```

### Step 3: Update deploy_iso.py

Edit `deploy_iso.py` and add this to `copy_assets()`:

```python
def copy_assets():
    log("copying assets and venv", "step")

    # Copy visual assets
    if os.path.exists(ASSETS_DIR):
        run_cmd(f"cp -r {ASSETS_DIR}/* {ISO_DIR}/furryos/assets/", "copying assets")

    # Copy venv for offline builds
    if os.path.exists("furryos_venv.tar.gz"):
        run_cmd(f"cp furryos_venv.tar.gz {ISO_DIR}/furryos/", "bundling venv")
        log("âœ“ venv will be included in ISO", "success")
    else:
        log("no venv archive found (optional)", "warning")
```

### Step 4: Add auto-extraction to installer

The installer script will auto-extract venv on first boot:

```bash
# In installer.sh
if [ -f /furryos/furryos_venv.tar.gz ]; then
    echo "ğŸ“¦ Extracting FurryOS venv..."
    tar -xzf /furryos/furryos_venv.tar.gz -C /opt/
    echo "âœ“ Python environment ready"
fi
```

---

## ğŸ”§ How It Works

### Transparent Auto-Detection

```python
# launcher.py detects venv automatically
def detect_venv():
    if venv_exists:
        # Re-execute script with venv Python
        os.execv(venv_python, [venv_python] + sys.argv)
```

**User Experience**:

```bash
$ ./launcher.py
ğŸ¾ Using FurryOS venv: furryos_venv
[LAUNCHER] Python: /TOP/furryos_venv/bin/python3
[LAUNCHER] âœ“ All dependencies available
```

No manual activation needed!

---

## ğŸ“Š venv vs System Python

| **Aspect**      | **System Python**   | **FurryOS venv**   |
| --------------- | ------------------- | ------------------ |
| PEP 668 issues  | âŒ May block pip    | âœ… No restrictions |
| Dependencies    | âŒ May conflict     | âœ… Isolated        |
| Offline builds  | âŒ Needs internet   | âœ… Works offline   |
| Consistency     | âŒ Varies by distro | âœ… Always same     |
| ISO size impact | âœ… 0 MB             | âš ï¸ ~50 MB          |

**Recommendation**: Include venv in ISO for best user experience.

---

## ğŸ—‘ï¸ Cleaning Up

### Remove venv

```bash
rm -rf furryos_venv/ furryos_venv.tar.gz
```

### Start fresh

```bash
./setup_venv.sh
```

---

## ğŸ¾ Advanced Usage

### Custom Packages

Add to venv before archiving:

```bash
source furryos_venv/bin/activate
pip install your-custom-package
pip freeze > furryos_venv/requirements.txt
deactivate

# Re-archive
tar -czf furryos_venv.tar.gz furryos_venv/
```

### Multiple Python Versions

Create version-specific venvs:

```bash
python3.12 -m venv furryos_venv_py312
python3.11 -m venv furryos_venv_py311
```

### Docker Alternative

If you prefer Docker over venv:

```bash
docker run -v $(pwd):/work -it debian:12 bash
cd /work
./setup_venv.sh
./launcher.py
```

---

## ğŸš¨ Troubleshooting

### "ModuleNotFoundError: No module named 'yaml'"

```bash
# Activate venv first
source activate_furryos.sh

# Or recreate it
./setup_venv.sh
```

### "Permission denied: furryos_venv"

```bash
# Fix permissions
chmod -R 755 furryos_venv/
```

### "Command not found: setup_venv.sh"

```bash
# Make executable
chmod +x setup_venv.sh
```

---

## ğŸ“‹ What's Included in venv

Default packages:

- `pyyaml` - YAML config parsing
- `requests` - HTTP downloads
- `pillow` - Image processing
- `mutagen` - Audio metadata
- `cryptography` - Encryption tools
- `jinja2` - Template engine

Total size: ~50 MB compressed, ~150 MB uncompressed

---

## ğŸ¯ Distribution Strategy

### For End Users

Include `furryos_venv.tar.gz` in ISO:

- Auto-extracts to `/opt/furryos_venv/` on install
- Scripts use it automatically
- User never knows it exists

### For Developers

Include in Git repo:

- `setup_venv.sh` - Creates fresh venv
- `requirements.txt` - Package list
- `activate_furryos.sh` - Quick activation

---

**Summary**: You DON'T need to reboot! Just run `./setup_venv.sh` in /TOP and you're ready to build. The venv is portable and can be bundled with the ISO for offline builds.

ğŸ¾ Go touch grass; venv is easy! ğŸŒ±
